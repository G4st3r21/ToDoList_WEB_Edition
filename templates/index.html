{% extends "base.html" %} {% block content %}
<main>
    <div class="container" id="cards" style="margin-top: 8em;">
        <div class="card_header">
            <h1>{{ list_name }}</h1>
            <div class="btn-group">
                <a
                    href="/tasks/today"
                    class="btn btn-secondary"
                    aria-current="page"
                    >Today's tasks</a
                >
                <a href="/tasks/upcoming" class="btn btn-secondary">All tasks</a>
            </div>
            <a href="/add_tasks" class="btn btn-primary" id="new_task">New task</a>
        </div>
        <div class="cards" id="tasks">
            {% for item in tasks %}
                <div class="card text-center" style="width: 18rem">
                    <div class="card-body">
                        <h5 class="card-title">
                            {{ item.title }} - {% if item.done %} Done! {% else %}
                            In progress {% endif %}
                        </h5>
                        <p class="card-text">Priority: {{ item.priority }}</p>
                        <div>
                            <a href="/tasks/{{ item.id }}" class="btn btn-info">Edit</a>
                            <a href="/tasks_delete/{{ item.id }}" class="btn btn-danger">Delete</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</main>

{% endblock content %}
{% block script %}
<script>
    function createTaskPattern(data) {
        var pattern = [
        '<div class="card text-center" style="width: 18rem">',
            '<div class="card-body">',
                '<h5 class="card-title">',
                data["title"],
                '</h5>',
                '<p class="card-text">Priority:',
                data["priority"],
                '</p>',
                '<div>',
                    '<a href="/tasks/',
                    data["id"],
                    '" class="btn btn-info">Edit</a>',
                    '<a href="/tasks_delete/',
                    data["id"],
                    '" class="btn btn-danger">Delete</a>',
                '</div>',
            '</div>',
        '</div>'
        ];

        return pattern.join('');
    }

    $(document).ready(function(){
        $.ajaxSetup ({
            cache: false
        });

        $("#finder").on("input", function(e){
            text = $("#finder").val();

            $.ajax({
                method: "post",
                url: "{{ url_for('search_request') }}",
                data: {text: text},
                success: function(res) {
                    var pattern, nodes = $();

                    $.each(res, function(index, value) {
                        pattern = createTaskPattern(value);
                        nodes = nodes.add($(pattern));

                    });

                    $('#tasks').html(nodes);
                }
            });
        });
    });
</script>
{% endblock %}